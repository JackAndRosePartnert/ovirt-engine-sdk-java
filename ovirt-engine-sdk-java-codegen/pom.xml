<project
  xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <groupId>org.ovirt.engine.sdk</groupId>
  <artifactId>ovirt-engine-sdk-java-codegen</artifactId>
  <packaging>jar</packaging>
  <version>1.0.0.1-SNAPSHOT</version>

  <name>ovirt-engine-sdk-java-codegen</name>
  <description>This is Java SDK codegen for oVirt virtualization</description>
  <url>http://www.ovirt.org/Java-sdk</url>

  <licenses>
    <license>
      <name>The Apache Software License, Version 2.0</name>
      <url>http://www.apache.org/licenses/LICENSE-2.0.txt</url>
      <distribution>repo</distribution>
    </license>
  </licenses>

  <properties>

    <!-- Make sure that we always compile with UTF-8 encoding: -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

    <!-- Default values used when retrieving the XML schema and the RSDL from
         a live engine: -->
    <api.url>https://localhost/ovirt-engine/api</api.url>
    <api.user>admin@internal</api.user>
    <api.password>letmein!</api.password>

  </properties>

  <dependencies>

    <dependency>
      <groupId>com.sun.xsom</groupId>
      <artifactId>xsom</artifactId>
      <version>20110809</version>
    </dependency>

  </dependencies>

  <build>

    <resources>

      <!-- This is needed because the templates used by the code generator
           are in the same directory than the Java source, and they aren't
           included in the resulting jar file by default: -->
      <resource>
        <directory>src/main/java</directory>
        <excludes>
          <exclude>**/*.java</exclude>
        </excludes>
      </resource>

    </resources>

    <plugins>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>2.3.2</version>
        <configuration>
          <source>1.7</source>
          <target>1.7</target>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.jvnet.jaxb2.maven2</groupId>
        <artifactId>maven-jaxb22-plugin</artifactId>
        <version>0.8.1</version>
        <executions>
          <execution>
            <id>generate-entities</id>
            <goals>
              <goal>generate</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <generatePackage>org.ovirt.engine.sdk.entities</generatePackage>
          <extension>true</extension>
        </configuration>
      </plugin>

    </plugins>

  </build>

  <profiles>

    <!-- This profile is used to download the XML schema and the RSDL from a
         live engine and update local copies. To run it use the validate phase
         and enable the profile:

         mvn validate -Pupdate-metadata

         After doing this remember to add update the files in the source
         control system. -->
    <profile>
      <id>update-metadata</id>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>exec-maven-plugin</artifactId>
            <version>1.2.1</version>
            <executions>
              <execution>
                <id>update-schema</id>
                <phase>validate</phase>
                <goals>
                  <goal>exec</goal>
                </goals>
                <configuration>
                  <executable>wget</executable>
                  <arguments>
                    <argument>--http-user=${api.user}</argument>
                    <argument>--http-password=${api.password}</argument>
                    <argument>--no-check-certificate</argument>
                    <argument>--output-document=${basedir}/src/main/resources/api.xsd</argument>
                    <argument>${api.url}?schema</argument>
                  </arguments>
                </configuration>
              </execution>
              <execution>
                <id>update-rsdl</id>
                <phase>validate</phase>
                <goals>
                  <goal>exec</goal>
                </goals>
                <configuration>
                  <executable>wget</executable>
                  <arguments>
                    <argument>--http-user=${api.user}</argument>
                    <argument>--http-password=${api.password}</argument>
                    <argument>--no-check-certificate</argument>
                    <argument>--output-document=${basedir}/src/main/resources/api.rsdl</argument>
                    <argument>${api.url}?rsdl</argument>
                  </arguments>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!-- This profile is used to regenerate the SDK from the XML schema and
         the RSDL documents. To run it use the validate phase and enable the
         profile:

         mvn validate -Pupdate-code

         After generating the code remember to add the modifications to the
         source code control system. -->
    <profile>
      <id>update-code</id>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>exec-maven-plugin</artifactId>
            <version>1.2.1</version>
            <executions>
              <execution>
                <id>update-code</id>
                <phase>validate</phase>
                <goals>
                  <goal>java</goal>
                </goals>
                <configuration>
                  <mainClass>org.ovirt.engine.sdk.codegen.Main</mainClass>
                  <arguments>
                    <argument>--xsd</argument>
                    <argument>${basedir}/src/main/resources/api.xsd</argument>
                    <argument>--rsdl</argument>
                    <argument>${basedir}/src/main/resources/api.rsdl</argument>
                  </arguments>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

  </profiles>

</project>
